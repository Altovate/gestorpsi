<!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
{% load i18n %}
{% load calculate_age %}
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<style>

@page {
  size: {{ pagesize }} portrait;
  margin: 1cm;
} 

body {
        font-family: Verdana, Arial, Helvetica, sans-serif;
        font-size: 12px;
}

hr {
    margin-top: 0px;
}

table {
     border: 0px;
}

td {
    vertical-align: top;
    padding: 4px 4px 0px 4px;
}


tr.title{
    background: #e6e6e6;
    text-align: center;
    font-weight: bold;
    font-size: 10px;
}

td.first {
        width: 120px;
}

.zebra_1 {
    background: #F9F9F9;
}

table.signature {
    font-size: 11px;
    text-align: center;
    margin-right: 20px;
}

/**
 * from pisa documentation: 
 * "Pisa is not able to split table cells that are larger than the available space. 
 * To work around it you may define what should happen in this case. 
 * The -pdf-keep-in-frame-mode can be one of: "error", "overflow", "shrink", "truncate", where "shrink" 
 * is the default value."
 */

/*
table {
    -pdf-keep-in-frame-mode: shrink;
}
*/

</style>
<title>{{ object.person.name }}</title></head>
<body>
<table>
    <tr>
        <td width="5%">
        {% if org_active.photo %}
            {% if DEBUG  %}
                <div  style="border:1px solid black">
                <small>{% trans "Image not available when Debug=True and server running in localhost" %}</small>
                </div>
            {% else %}
                <img width="134px" alt="{{ org_active.trade_name }}" src="{{ MEDIA_URL }}img/organization/{{ org_active.id}}/.thumb/{{ org_active.photo }}">
            {% endif %}
        {% endif %}
        </td>
        <td style="padding-left: 5px; font-size: 12px;">
            <b>{{ org_active.trade_name }}</b><br>
            {% if org_active.get_first_address %} {{ org_active.get_first_address|safe }} {% endif %}<br>
            {% if org_active.phones.all %} {{ org_active.phones.all|join:", "}} {% endif %}<br>
        </td>
        <td style="text-align:right;font-size: 12px;">
                <b>{% trans "Client Report" %}</b><br>
        {% trans "generated at" %} {% now "d/m/Y H:i" %} hs<br>
        {% trans "by " %} {{ user.get_profile.person.name }}<br>
        </td>
    </tr>
</table>

<hr />

<br>

<table>
<tr>
<td style="width: 626px; vertical-align: top; padding: 0px;">
      
      <h2>{{ object.person.name }}</h2>
      {% if not object.is_company %}
        {% trans "Gender" %}: 
            {% if object.person.gender %}
                {% ifequal object.person.gender '1' %} {% trans "Female" %} {% endifequal %}   
                {% ifequal object.person.gender '2' %} {% trans "Male" %} {% endifequal %}   
            {% else %}{% trans "Not Informed" %}{% endif %}<br>
        {% trans "Birthdate" %}: {% if object.person.birthDate %}{% if not object.person.birthDateSupposed %}{{ object.person.birthDate|date:"d/m/Y" }}{% endif %} - {{ object.person.birthDate|age }} {% trans "years old" %} {% if object.person.birthDateSupposed %}<b>{% trans "Birthdate is supposed" %}</b>{% endif %}{% else %}{% trans "Not Informed" %}{% endif %} <br>
        {% trans "Marital Status" %}: {% if object.person.maritalStatus %}{{ object.person.maritalStatus }}{% else %}{% trans "Not Informed" %}{% endif %}<br>
        {% trans "Birth Place" %}: 
            {% if object.person.birthPlace or object.person.birthForeignCity or object.person.birthForeignState or object.person.birthForeignCountry %}
                {% if object.person.birthPlace %}
                    {{ object.person.birthPlace|title }} {{ object.person.birthPlace.state.shortName }} {{ object.person.birthPlace.state.country }}
                {% else %}
                    {{ object.person.birthForeignCity }} {{ object.person.birthForeignState }} {{ object.person.birthForeignCountry }}
                {% endif %}
            {% else %}{% trans "Not Informed" %}{% endif %}<br>
        {% endif %}
</td>
<td>
{% if DEBUG  %}
    <div  style="border:1px solid black">
    <small>{% trans "Image not available when Debug=True and server running in localhost" %}</small>
    </div>
{% else %}
    {% if not object.person.photo %}
        <img width="116px" alt="Client Picture" src="{{ MEDIA_URL }}img/generic_photo.gif">
    {% else %}
        <img width="116px" alt="Client Picture" src="{{ MEDIA_URL }}img/organization/{{ org_active.id}}/.thumb/{{ object.person.photo }}">
    {% endif %}
{% endif %}
</td>
</tr>
</tbody>
</table>
<br />

{% if object.is_company and object.person.company.cnae_class %}
<strong>{% trans "Cnae" %}</strong><hr />
{{ object.person.company.cnae_class }} - {{ object.person.company.cnae_class_name }}
<br /><br />
{% endif %}

{% if object.person.document.all %}
<strong>{% trans "Document" %}</strong><hr />
{{ object.person.document.all|join:"<br /> " }}
<br /><br />
{% endif %}

{% if object.person.phones.all %}
<strong>{% trans "Phone" %}</strong><hr />
{{ object.person.phones.all|join:", "}}
<br /><br />
{% endif %}

{% if object.person.address.all %}
<strong>{% trans "Address" %}</strong><hr />
{% for i in object.person.address.all%}
    {{ i|safe }}
    {% if not forloop.last %}<br /><br />{% endif %}
{% endfor %}
<br /><br />
{% endif %}

{% if object.person.emails.all %}
<strong>{% trans "Email" %}</strong><hr />
{% for i in object.person.emails.all %}
    {{ i.email }} ({{ i.email_type }})
    {% if not forloop.last %}, {% endif %}
{% endfor %}
<br /><br />
{% endif %}

{% if object.person.sites.all %}
<strong>{% trans "Website" %}</strong><hr />
{% for i in object.person.sites.all %}
    {{ i.site }} {% if i.description %}({{ i.description }}){% endif %}
    {% if not forloop.last %}, {% endif %}
{% endfor %}
<br /><br />
{% endif %}

{% if object.person.instantMessengers.all %}
<strong>{% trans "Instant Messenger" %}</strong><hr />
{{ object.person.instantMessengers.all|join:", " }}
<br /><br />
{% endif %}


{% if not object.person.comments.all %}
<strong>
{{ object.person.comments|safe }}
</strong>
<br /><br />
{% endif %}


<strong>
      {% if object.is_company %}{% trans "Employees Related" %}
      {% else%}{% trans "Family Relations" %}
      {% endif %}
</strong><hr />
{% if object.is_company %}
    {% if not company_related_clients %}
        {% trans "There is no related client information" %}
    {% else %}
    {% for i in company_related_clients %}
        {{ i.client }} ({% if i.active %}{% trans "Active" %}{% else %}{% trans "Deactive" %}{% endif %}) {% if i.responsible %} - {% trans "Responsible" %}{% endif %}
    {% if not forloop.last %},{% endif %}
    {% endfor %}
    {% endif %}
{% else%}
    {% if not object.family_members_active %}
        {% trans "There is no family members information" %}
    {% else %}
    {% for i in object.family_members_active %}
    {{ i.1 }} - {{ i.2 }} {% if i.6 %}<br /><small>{{ i.6 }}</small>{% endif %}<br />
    {% endfor %}
    {% endif %}
{% endif %}
<br /><br />

{% if print_demographic and not object.is_company %}
<h1>{% trans "Demographic Data" %}</h1>
<strong>{% trans "Education Level" %}</strong><hr />
<table>
    <tr class="zebra_0">
        <td>{% trans "School Grade" %}</td>
        <td>{% if not object.educationallevel.get_school_grade_display %}{% trans "Not informed" %}{% else %}{{ object.educationallevel.get_school_grade_display }}{% endif %}</td>
    </tr>
    <tr class="zebra_1">
        <td>{% trans "Comments" %}</td>
        <td>{{ object.educationallevel.comments }}</td>
    </tr>
</table>

<br />
<strong>{% trans "Occupations" %}</strong>
{% if not object.profession_set.all %}
    <hr />{% trans "Client have no occupation registered" %}
{% else %}
      <table>
          <tr class="title" nowrap="nowrap">
            <td><small>{% trans "Profession" %}</small></td>
            <td nowrap="nowrap"><small>{% trans "Labor Market Status" %}</small></td>
            <td><small>{% trans "Workplace" %}</small></td>
            <td><small>{% trans "Working Hours" %}</small></td>
            <td><small>{% trans "Status" %}</small></td>
            <td><small>{% trans "Comments" %}</small></td>
        </tr>
        {% for p in object.profession_set.all %}
        <tr class="zebra_{% cycle 0,1 %}">
            <td><small>{{ p.profession }}</small></td>
            <td><small>{{ p.get_labor_market_status_display }}</small></td>
            <td><small>{{ p.workplace }}</small></td>
            <td><small>{{ p.working_hours }}</small></td>
            <td><small>{% if not p.status %}{% trans "Do not active in this occupation" %}{% else %}{% trans "Still active in this occupation" %}{% endif %}</small></td>
            <td><small>{{ p.comments }}</small></td>
        </tr>
        {% endfor %}
      </table>
{% endif %}
<br />
{% endif %}

<h1>{% trans "Admission Details" %}</h1>
<table>
    <tr class="zebra_1">
        <td>{% trans "Admission Date" %}</td>
        <td>{{ object.admission_date|date:"d/m/Y" }}</td>
    </tr>
    <tr class="zebra_0">
        <td>{% trans "ID Record" %}</td>
        <td>{{ object.idRecord }}</td>
    </tr>
    <tr class="zebra_1">
        <td class="first">{% trans "Legacy Record" %}</td>
        <td>{{ object.legacyRecord }}</td>
    </tr>
    <tr class="zebra_0">
        <td class="first">{% trans "Admission Knowledge" %}</td>
        <td>
            {% if not object.admissionreferral_set.all %}
            {% trans "There is no information available" %}
            {% else %}
            {% for i in object.admissionreferral_set.all %}
                {{ i.referral_choice }} 
                {% if i.referral_organization or i.referral_professional %} 
                    ({% if i.referral_organization.name %}{{ i.referral_organization.name }}{% endif %}{% if i.referral_professional %}{{ i.referral_professional }}{% endif %})
                {% endif %}
                {% if not forloop.last %},{% endif %}
            {% endfor %}
            {% endif %}
        </td>
    </tr>

    <tr class="zebra_1">
      <td class="first">{% trans "Signed by the client" %}</td>
      <td>{% for a in object.admissionreferral_set.all %}
            {% if not a.signed_bythe_client %}{% trans "No" %}{% else %}{% trans "Yes" %}{% endif %}
          {% endfor %}
       </td>
    </tr>


    <tr class="zebra_1">
      <td class="first">{% trans "Admission Files" %}</td>
      <td>
      {% if not object.attach_set.all %}
        {% trans "Admission have no attached file" %}
      {% else %}
      <table>
          <tr class="title" nowrap="nowrap">
            <td><small>{% trans "Filename" %}</small></td>
            <td><small>{% trans "Date" %}</small></td>
            <td><small>{% trans "Type" %}</small></td>
            <td><small>{% trans "Description" %}</small></td>
        </tr>
        {% for attach in object.attach_set.all %}
        <tr class="zebra_{% cycle 0,1 %}">
            <td><small>{{ attach.filename }}</small></td>
            <td><small>{{ attach.date|date:"d/m/Y" }}</small></td>
            <td><small>{{ attach.get_type_display }}</small></td>
            <td><small>{{ attach.description }}</small></td>
        </tr>
        {% endfor %}
      </table>
      {% endif %}
      </td>
    </tr>
    <tr class="zebra_0">
      <td>{% trans "Comments" %}</td>
      <td>{{ object.comments }}</td>
    </tr>
</table>
<br />

{% if not object.is_company %}
    <h1>
    {% if not object.referral_set.all %}
        {% trans "Client has no subscribed referral" %}
    {% else %}
    {% trans "Client Referrals" %}
    {% endif %}
    </h1>

    {% for i in referral %}
        <strong>{{ i.service }}{% if i.service.academic_related %} ({% trans "Service is academic related" %}){% endif %}</strong><hr />
        <table>
            <tr class="zebra_1">
                <td class="first">{% trans "Date" %}</td>
                <td>{{ i.date|date:"d/m/Y" }}</td>
            </tr>
            <tr>
                <td class="first">{% trans "Professionals" %}</td>
                <td>
                    {% if not i.professional.all %}&nbsp;{% else %}
                    {% for p in i.professional.all %}
                    {{ p.person.name }}
                    {% if not p.is_student %}
                    {{ p.professionalIdentification.profession.symbol }} {{ p.professionalIdentification.registerNumber }}
                    {% else %}
                        ({{ p.studentprofile.lecture_class.academic_name }})
                    {% endif %}{% if not forloop.last %},{% endif %}
                    {% endfor %}
                    {% endif %}
                </td>
            </tr>
            <tr class="zebra_1">
                <td class="first">{% trans "Professionals Responsible" %}</td>
                <td>
                    {% if not i.service.responsibles.all %}
                        {% trans "This referral have no responsible professional" %}
                    {% else %}
                        {% for p in i.service.responsibles.all %}
                            {{ p.person.name }} {{ p.professionalIdentification.profession.symbol }} {{ p.professionalIdentification.registerNumber }}
                        {% if not forloop.last %},{% endif %}
                    {% endfor %}
                    
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td class="first">{% trans "Referral Source" %}</td>
                <td>{% if not i.referral %}&nbsp;{% else %}{{ i.referral }}{% endif %}</td>
            </tr>
            <tr class="zebra_1">
                <td class="first">{% trans "Group" %}</td>
                <td>
                {% if not i.group %}{% trans "No"%}{% else%}{{ i.group }}{% endif %}</td>
            </tr>
            <tr>
                <td class="first">{% trans "Status" %}</td>
                <td>
                    {% if i.referraldischarge_set.all %}
                        {% trans "Referral is discharged" %}
                    {% else %}
                        {% trans "Service is charged" %}
                    {% endif %}
                
                </td>
            </tr>
            <tr class="zebra_1">
                <td class="first">{% trans "Reason" %}</td>
                <td>{% if not i.referral_reason %}{% trans "Not informed" %}{% else %}{{ i.referral_reason }}{% endif %}</td>
            </tr>
            <tr>
                <td class="first">{% trans "Priority" %}</td>
                <td>{% if not i.priority %}{% trans "Not informed" %}{% else %}{{ i.priority }}{% endif %}</td>
            </tr>
            <tr class="zebra_1">
                <td class="first">{% trans "Impact" %}</td>
                <td>{% if not i.impact %}{% trans "Not informed" %}{% else %}{{ i.impact }}{% endif %}</td>
            </tr>
            <tr>
                <td class="first">{% trans "Available Time" %}</td>
                <td>{{ i.available_time }}</td>
            </tr>
            <tr class="zebra_1">
                <td class="first">{% trans "Comments" %}</td>
                <td>{{ i.annotation }}</td>
            </tr>
            <tr>
                <td class="first">{% trans "Queue Details" %}</td>
                <td>
                    {% for q in i.queue_set.all %}
                        {% ifequal object q.client  %}
                            <strong>{% trans "in" %}</strong> {{ q.date_in|date:"d/m/Y" }} <strong>{% trans "Out" %}</strong> {% if q.date_out %} {{ q.date_out|date:"d/m/Y" }}{% else %} {% trans "still on queue" %}{% endif %}
                        {% endifequal %}
                        {% if not forloop.last %}<br />{% endif %}
                    {% endfor %}
                </td>
            </tr>
            <tr class="zebra_1">
                <td class="first">{% trans "Discharge Detail" %}</td>
                <td>
                {% if i.referraldischarge_set.all %}
                {% for d in i.referraldischarge_set.all %}
                    <strong>{% trans "Reason" %}</strong><br />
                    {% if not d.reason %}{% trans "Not informed" %}{% else %}
                    {{ d.get_reason_display }}{% endif %}<br />
                    <strong>{% trans "Was discussed with client" %}</strong><br />
                    {% if not d.was_discussed_with_client %}{% trans "No" %}{% else %}{% trans "Yes" %}{% endif %}<br />
                    {% if d.details %}<strong>{% trans "Details" %}</strong><br /> {{ d.details }}<br />{% endif %}
                    {% if d.description %}<strong>{% trans "Description" %}</strong><br /> {{ d.description }}<br />{% endif %}
                {% endfor %}
                {% endif %}
                </td>
            </tr>
            <tr>
                <td class="first">{% trans "Referral total occurrences" %}</td>
                <td>
                {% if not i.occurrence_set.all %}
                    {% trans "This referral have no occurrences registered" %}
                {% else %}
                    {{ i.occurrence_set.all|length }}
                {% endif %}
                </td>
            </tr>
        </table>
        
        <br />
        {% if print_schedule %}
            <strong>{% trans "Referral Occurrences" %}</strong><br />
            {% if not i.occurrence_set.all %}
                {% trans "This referral have no occurrence" %}
            {% else %}
            <table>
              <tr class="title" nowrap="nowrap">
                <td width="19%" nowrap="nowrap">{% trans "Date" %}</td>
                <td nowrap="nowrap" width="50%">{% trans "Occurrence Confirmation" %}</td>
                <td nowrap="nowrap">{% trans "Place" %}</td>
                <td nowrap="nowrap">{% trans "Room" %}</td>
                <td nowrap="nowrap">{% trans "Devices" %}</td>
                <td nowrap="nowrap">{% trans "Notes" %}</td>
            </tr>
            {% for o in i.occurrence_set.all %}
            <tr class="zebra_{% cycle 0,1 %}">
                <td width="19%" nowrap="nowrap"><small>{{ o.start_time|date:"d/m/Y H:i" }} - {{ o.end_time|date:"H:i" }}{% trans "hs" %}</small></td>
                <td width="50%"><small>
                {% if not o.scheduleoccurrence.was_confirmed %}
                    {% trans "Not confirmed" %}
                {% else %}
                    <strong>{{ o.scheduleoccurrence.occurrenceconfirmation.get_presence_display }} </strong><br />
                    
                    {% if o.scheduleoccurrence.occurrenceconfirmation.date_started %}
                    {% trans "Time started/finished" %} {{ o.scheduleoccurrence.occurrenceconfirmation.date_started|date:"H:i"}} {{ o.scheduleoccurrence.occurrenceconfirmation.date_finished|date:"H:i"}}{% trans "hs" %}
                    {% endif %}
                    {% if o.scheduleoccurrence.occurrenceconfirmation.reason %}
                        <br />{{ o.scheduleoccurrence.occurrenceconfirmation.reason }}
                    {% endif %}
                    {% if o.scheduleoccurrence.occurrenceconfirmation.device.all %}
                        <strong>{% trans "Utilized Devices" %}</strong><br />
                        {{ o.scheduleoccurrence.occurrenceconfirmation.device.all|join:", " }}
                    {% endif %}
                    
                {% endif %}
                </small></td>
                <td nowrap="nowrap"><small>{{ o.scheduleoccurrence.room.place }}</small></td>
                <td nowrap="nowrap"><small>{{ o.scheduleoccurrence.room }}</small></td>
                <td><small>{{ o.scheduleoccurrence.device.all|join:", " }}</small></td>
                <td><small>{{ o.scheduleoccurrence.annotation }}</small></td>
            </tr>
            {% endfor %}
            </table>
            {% endif %}
        {% endif %}
        <br />
        {% if print_ehr and have_ehr_read_perms %}
            <strong>{% trans "Referral Sessions" %}</strong><br />
            {% if not i.session_set.all %}
                {% trans "This referral have no session registered yet" %}
            {% else %}
            <table>
              <tr class="title" nowrap="nowrap">
                <td width="19%" nowrap="nowrap">{% trans "Date" %}</td>
                <td nowrap="nowrap">{% trans "Session Goals" %}</td>
                <td nowrap="nowrap" width="30%">{% trans "Descriptive" %}</td>
                <td nowrap="nowrap" width="30%">{% trans "Comments" %}</td>
            </tr>
            {% for o in i.session_set.all %}
            <tr class="zebra_{% cycle 0,1 %}">
                <td width="19%" nowrap="nowrap"><small>{{ o.occurrence.start_time|date:"d/m/Y H:i" }} - {{ o.occurrence.end_time|date:"H:i" }}{% trans "hs" %}</small></td>
                <td nowrap="nowrap"><small>{{ o.get_session_goals_display }}</small></td>
                <td><small>{{ o.descriptive }}</small></td>
                <td><small>{{ o.comments }}</small></td>
            </tr>
            {% endfor %}
            </table>
            {% endif %}
        {% endif %}

        <br />
        {% if print_ehr and have_ehr_read_perms %}
            <strong>{% trans "Referral Demands" %}</strong><br />
            {% if not i.demand_set.all %}
                {% trans "This referral have no demand registered yet" %}
            {% else %}
            <table>
              <tr class="title" nowrap="nowrap">
                <td width="150px" nowrap="nowrap">{% trans "Occurrence Date" %}</td>
                <td nowrap="nowrap">{% trans "Demand" %}</td>
                <td nowrap="nowrap">{% trans "Initial complaint" %}</td>
                <td nowrap="nowrap">{% trans "How long it happens" %}</td>
                <td nowrap="nowrap">{% trans "Frequency" %}</td>
                <td nowrap="nowrap">{% trans "Severity" %}</td>
                <td nowrap="nowrap">{% trans "Duration" %}</td>
                <td nowrap="nowrap">{% trans "Status" %}</td>
                <td nowrap="nowrap">{% trans "Resolution" %}</td>
              </tr>
              
            {% for o in i.demand_set.all %}
                <tr class="zebra_{% cycle 0,1 %}">
                    <td width="150px" nowrap="nowrap"><small>{% if not o.occurrence.start_time %}{% trans "Not related" %}{% else %}{{ o.occurrence.start_time|date:"d/m/Y H:i" }} - {{ o.occurrence.end_time|date:"H:i" }}{% trans "hs" %}{% endif %}</small></td>
                    <td nowrap="nowrap"><small>{{ o.demand }}</small></td>
                    <td><small>{% if not o.initial_complaint %}{% trans "No" %}{% else %}{% trans "Yes" %}{% endif %}</small></td>
                    <td><small>{{ o.how_long_it_happens.unit }} {{ o.how_long_it_happens.get_time_display }}</small></td>
                    <td><small>{{ o.frequency.unit }} {{ o.frequency.get_time_display }}</small></td>
                    <td><small>{{ o.get_severity_display }}</small></td>
                    <td><small>{{ o.duration.unit }} {{ o.duration.get_time_display }}</small></td>
                    <td><small>{{ o.get_demand_status_display }}</small></td>
                    <td><small>{{ o.demand_resolution|date:"d/m/Y" }}</small></td>
                </tr>
                
                <tr class="zebra_{% cycle 0,1 %}">
                    <td></td>
                    <td colspan="8">
                        <strong>{% trans "Description" %}</strong>
                        <small>{% if not o.description %} {% trans "Not informed" %}{% else %}<br />{{ o.description }}{% endif %}</small><br />
                        <strong>{% trans "Bibliography" %}</strong>
                        <small>{% if not o.bibliography %} {% trans "Not informed" %}{% else %}<br />{{ o.bibliography }}{% endif %}</small><br />
                        <strong>{% trans "Related Sites" %}</strong>
                        <small>{% if not o.related_sites %} {% trans "Not informed" %}{% else %}<br />{{ o.related_sites }}{% endif %}</small><br />
                        <strong>{% trans "Comments" %}</strong>
                        <small>{% if not o.comments %} {% trans "Not informed" %}{% else %}<br />{{ o.comments }}{% endif %}</small><br />
                    </td>
                </tr>
            {% endfor %}
            </table>
            {% endif %}
        {% endif %}

        <br />
        {% if print_ehr and have_ehr_read_perms %}
            <strong>{% trans "Referral Diagnosis" %}</strong><br />
            {% if not i.diagnosis_set.all %}
                {% trans "This referral have no diagnose registered yet" %}
            {% else %}
            <table>
              <tr class="title" nowrap="nowrap">
                <td width="150px" nowrap="nowrap">{% trans "Occurrence Date" %}</td>
                <td nowrap="nowrap">{% trans "Date" %}</td>
                <td nowrap="nowrap" width="62px">{% trans "Resolution" %}</td>
                <td>{% trans "Diagnose" %}</td>
                <td nowrap="nowrap">{% trans "Status" %}</td>
                <td nowrap="nowrap">{% trans "Severity" %}</td>
              </tr>
            </tr>
            {% for o in i.diagnosis_set.all %}
            <tr class="zebra_{% cycle 0,1 %}">
                <td width="150px" nowrap="nowrap"><small>{% if not o.occurrence.start_time %}{% trans "Not related" %}{% else %}{{ o.occurrence.start_time|date:"d/m/Y H:i" }} - {{ o.occurrence.end_time|date:"H:i" }}{% trans "hs" %}{% endif %}</small></td>
                <td nowrap="nowrap"><small>{{ o.diagnosis_date|date:"d/m/Y" }}</small></td>
                <td width="62px"><small>{{ o.diagnosis_resolution|date:"d/m/Y" }}</small></td>
                <td><small>{{ o.diagnosis }}</small></td>
                <td><small>{{ o.get_diagnosis_status_display }} {{ o.get_diagnosis_status2_display }}</small></td>
                <td><small>{{ o.get_severity_display }}</small></td>
            </tr>
            <tr>
                <td></td>
                <td colspan="5">
                    <strong>{% trans "Description" %}</strong>
                    <small>{% if not o.clinical_description %} {% trans "Not informed" %}{% else %}<br />{{ o.clinical_description }}{% endif %}</small><br />
                    <strong>{% trans "Treatment Indicated" %}</strong>
                    <small>{% if not o.treatment_indicated %} {% trans "Not informed" %}{% else %}<br />{{ o.treatment_indicated }}{% endif %}</small><br />
                    <strong>{% trans "Bibliography" %}</strong>
                    <small>{% if not o.bibliography %} {% trans "Not informed" %}{% else %}<br />{{ o.bibliography }}{% endif %}</small><br />
                    <strong>{% trans "Related Sites" %}</strong>
                    <small>{% if not o.related_sites %} {% trans "Not informed" %}{% else %}<br />{{ o.related_sites }}{% endif %}</small><br />
                    <strong>{% trans "Comments" %}</strong>
                    <small>{% if not o.comments %} {% trans "Not informed" %}{% else %}<br />{{ o.comments }}{% endif %}</small><br />
                </td>
            </tr>
            {% endfor %}
            </table>
            {% endif %}
        {% endif %}
    <br />
            {% if i.service.academic_related and i.service.responsibles.all %}
            <br /><br />
            <table class="signature">
                <tr>
                    {% for p in i.service.responsibles.all %}
                    <td>____________________________</td>
                    {% endfor %}
                </tr>
                <tr>
                    {% for p in i.service.responsibles.all %}
                    <td>{{ p.person.name }} {{ p.professionalIdentification.profession.symbol }} {{ p.professionalIdentification.registerNumber }}</td>
                    {% endfor %}
                </tr>
            </table>
            {% endif %}
    <br />
            {% if not i.professional.all %}&nbsp;{% else %}
            <br /><br />
            <table class="signature">
                <tr>
                    {% for p in i.professional.all %}
                    <td>____________________________</td>
                    {% endfor %}
                </tr>
                <tr>
                    {% for p in i.professional.all %}
                    <td>{{ p.person.name }} {{ p.professionalIdentification.profession.symbol }} {{ p.professionalIdentification.registerNumber }}</td>
                    {% endfor %}
                </tr>
            </table>
            {% endif %}
        
    <br /><br />
    {% endfor %} {# referrals #}

{% endif %}


{% comment %}
<div id="footerblock">
{%block pager %}
    <pdf:pagenumber>
{%endblock%}
</div>
{% endcomment %}

</body></html>

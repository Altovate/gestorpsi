{% extends "core/main.html" %}

{% comment %}

Copyright (C) 2008 GestorPsi

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

{% endcomment %}

{% load i18n %}
{% load calculate_age %}

{% block menu_client %}active{% endblock %}

{% block submenu %}
    {% include "client/client_menu.html" %}
{% endblock %}

{% block core %}
<input type="hidden" name="object_id" value="{{ object.id }}" />

<h2 id="title_addressbook" style="display:none"></h2>

	<h2 class="title_clients title">{{ object.person.name }}</h2>
	<p class="description">{% trans "Customer subscribed in" %} <a href="/client/{{ object.id }}/referral/">{{ referrals|length }} {% trans "service(s)" %}</a> <br />	

</p>

<div class="main_area home">
	<!-- <a href="" id="help">&nbsp;</a> -->
	<!-- DataTypes form menu -->
	<h3><span>{% trans "Administrative Details" %}</span></h3>
    <div class="photo">
        <img class="img_people" src="{% if object.person.photo %}/media/img/organization/{{ user.get_profile.org_active.id }}/.thumb/{{ object.person.photo }}{% else %}/media/img/generic_photo.gif{% endif %}" />
        <br /><br />
    </div>    
    <h1>{{ object.person.name }}</h1>
    <p><span class="big">{% if object.person.maritalStatus %}{% trans "Marital Status" %}: {{ object.person.maritalStatus }}{% endif %}</span></p>
    <p><span class="big">{% if object.person.birthDate %}{% trans "Age" %}: {{ object.person.birthDate|age }} {% trans "years" %} {% endif %}</span></p>
    {% if object.person.address.all %}
        <p>
        {% for i in object.person.address.all %}
            {{ i.addressPrefix }} {{ i.addressLine1 }}, {{ i.addressNumber }} {{ i.addressLine2 }}  - {{ i.neighborhood }} {{ i.zipCode }} {{ i.city }} {{ i.city.state.shortName }}, {{ i.city.state.country }}
            <br>
        {% endfor %}
        </p>
    {% endif %}
    {% if object.person.emails.all %}
        <p>
        {% for i in object.person.emails.all %}<a href="mailto:{{ i.email }}">{{ i }}</a> ({{ i.email_type }})<br>{% endfor %}
        </p>
    {% endif %}
    {% if object.person.phones.all %}
        <p>
        {% for i in object.person.phones.all %}{% if i.area %}({{ i.area }}){% endif %}&nbsp;<span class="big">{{ i.phoneNumber }}</span> ({{ i.phoneType}})<br>{% endfor %}
        </p>
    {% endif %}
</p>
    <p>
    
    <a href="/client/{{ object.id}}/" title="{% trans "edit" %}" class="edit"><span>{% trans "edit" %}</span></a>
    </p>

<br />	

</div>

<div class="main_area home">
	<!-- <a href="" id="help">&nbsp;</a> -->
	<!-- DataTypes form menu -->
	<h3><span>{% trans "Referrals Details" %}</span></h3>
    
    
    <h2  class="red">{% trans "Subscribed Services" %} ({{ referrals|length }})</h2>
    {% if not referrals|length %}
        <p>{% trans "This customer has not been subscribed yet!" %}&nbsp;<a href="/client/{{ object.id}}/referral/form/">{% trans "Subscribe it now?" %}</a></p>
    {% else %}
        <p>
            <ul>
            {% for i in referrals %}
                <li><a href="/client/{{ object.id}}/referral/{{ i.id }}/">{{ i.service }}</a> {% if i.upcoming_occurrences %} {% trans "with" %} {{ i.upcoming_occurrences|length }} {% trans "occurrences remaining" %}{% endif %}<br />
                {% for p in i.professional.all %}
                    <b>{{ p }}</b> {% for i in p.person.phones.all %} {{ i }} {{ i.phoneType }} {% endfor %}{{ p.person.get_first_email }}<br />
                {% endfor %}
                    {% if i.next_occurrence %}
                        {% trans "Next occurrence" %}:
                        {{ i.next_occurrence.start_time|date:"l, d" }} {% trans "of" %} {{ i.next_occurrence.start_time|date:"F" }} {% trans "of" %} {{ i.next_occurrence.start_time|date:"Y" }} {{ i.next_occurrence.start_time|date:"H:i" }} - {{ i.next_occurrence.end_time|date:"H:i" }}
                    {% else %}
                        {% trans "There is no upcoming occurrences for this service" %} <a href="/client/schedule/daily/?referral={{ i.id }}&client={{ object.id }}" class="small"><small>{% trans "book it now?" %}</small></a>
                    {% endif %}
                    
                </li>
            {% endfor %}
            </ul>
        </p>
        <br /><a href="/client/{{ object.id}}/referral/form/">{% trans "New subscribe" %}</a><br />
    {% endif %}
<br />	

</div>

<div id="sidebar" class="sidebar">
    {% if object.id %}
        {% include "tags/client_sidebar.html" %}
    {% endif %}
</div>

{% endblock %}

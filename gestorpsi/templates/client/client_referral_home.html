{% extends "core/main.html" %}

{% comment %}

Copyright (C) 2008 GestorPsi

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

{% endcomment %}

{% load i18n %}

{% block menu_client %}active{% endblock %}

{% block submenu %}
    {% include "client/client_menu.html" %}
{% endblock %}

{% block core %}
<input type="hidden" name="object_id" value="{{ object.id }}" />

<h2 id="title_addressbook" style="display:none"></h2>

	<h2 class="title_clients title">{{ object.person.name }} {% trans "in" %} {{ referral }}</h2>
	<p class="description">{% trans "Client subscribed in this service since" %} {{ referral.date|date:"d" }} {% trans "of" %} {{ referral.date|date:"F" }} {% trans "of" %} {{ referral.date|date:"Y" }}<br />	

</p>

<div class="main_area home">
	<!-- <a href="" id="help">&nbsp;</a> -->
	<!-- DataTypes form menu -->
	<h3><span>{% trans "Referral Details" %}</span></h3>
    <div class="photo">
        <img class="img_people" src="{% if object.person.photo %}/media/img/organization/{{ user.get_profile.org_active.id }}/.thumb/{{ object.person.photo }}{% else %}/media/img/generic_photo.gif{% endif %}" />
        <br /><br />
    </div>    
    <h2 class="red">{% trans "Referral Details" %}</h2>
        <p>{% trans "This referral has" %} {{ referral.upcoming_occurrences|length }} {% trans "upcoming event(s) and" %} {{ referral.past_occurrences|length }} {% trans "past events" %} </p>
        <p>
        {% if referral.next_occurrence %}
            {% trans "Next occurrence at" %} 
            {{ referral.next_occurrence.start_time|date:"l, d" }} {% trans "of" %} {{ referral.next_occurrence.start_time|date:"F" }} {% trans "of" %} {{ referral.next_occurrence.start_time|date:"Y" }} {{ referral.next_occurrence.start_time|date:"H:i" }} - {{ referral.next_occurrence.end_time|date:"H:i" }}
        {% endif %}
        </p>
        <p>
        {% if referral.last_occurrence %}
            {% trans "Last occurrence" %} 
            {{ referral.last_occurrence.start_time|date:"l, d" }} {% trans "of" %} {{ referral.last_occurrence.start_time|date:"F" }} {% trans "of" %} {{ referral.last_occurrence.start_time|date:"Y" }} {{ referral.last_occurrence.start_time|date:"H:i" }} - {{ referral.last_occurrence.end_time|date:"H:i" }}
        {% endif %}
        </p>
        <p>
        
        {% if not referral.professional.all %}
            {% trans "There is no professional in this referral." %} <a href="/client/{{ object.id}}/referral/{{ referral.id }}/form/">{% trans "Add one now?" %}</a>
        {% else %}
        <b />{% trans "Professionals from this referral" %}</b>
        <br />
        {% for i in referral.professional.all %}
            <a href="/careprofessional/{{ i.id }}/" title="{{ i }}">{{ i }}</a><br />{% for p in i.person.phones.all %} {{ p }} {{ p.phoneType }} {% endfor %}{{ i.person.get_first_email }}
        
        {% endfor %}
        {% endif %}
        </p>
        
<br />	
</div>

<div class="main_area home">
	<!-- <a href="" id="help">&nbsp;</a> -->
	<!-- DataTypes form menu -->
	<h3><span>{% trans "Schedule Details" %}</span></h3>

    <h2 class="red">{% trans "Upcoming schedules for this service" %}</h2>
    <p>
    {% if not referral.upcoming_occurrences %}
        {% trans "This customer has no upcoming schedules yet!" %}&nbsp;<a href="/client/schedule/daily/?referral={{ referral.id }}&client={{ object.id }}">{% trans "Book it now?" %}</a>
    {% else %}
        {% for i in referral.upcoming_occurrences %}
             {{ i.start_time|date:"r"|slice:"-9" }} hs - {{ i.scheduleoccurrence.room }}
            <br>
        {% endfor %}
    
    <a href="/client/schedule/daily/?referral={{ referral.id }}&client={{ object.id }}" title="{% trans "Book new" %}">{% trans "Book new" %}</a>
    {% endif %}
    </p>



    <h2 class="red">{% trans "Past schedules for this service" %}</h2>
    <p>
    {% if not referral.past_occurrences %}
            {% trans "This customer has no past schedules!" %}
    {% else %}
        {% for i in referral.past_occurrences %}
            {{ i.start_time|date:"r"|slice:"-9" }} hs - {{ i.scheduleoccurrence.room }}
            <br>
        {% endfor %}
    {% endif %}
    </p>

<br />	
</div>

<div id="sidebar" class="sidebar">
    {% if object.id %}
        {% include "tags/client_sidebar.html" %}
    {% endif %}
</div>

{% endblock %}

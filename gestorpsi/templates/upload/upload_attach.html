{% extends "core/main.html" %}

{% comment %}

Copyright (C) 2008 GestorPsi

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

{% endcomment %}

{% load i18n %}

{% block menu_client %}active{% endblock %}

{% block submenu %}
    {% include "client/client_menu.html" %}
{% endblock %}

{% block core %}

    <h2 id="title_addressbook" style="display:none"></h2>

	<h2 class="title_clients title">{{ object.person.name }} {% trans "in" %} {{ referral }}</h2>
	<p class="description">{% trans "Client subscribed in this service since" %} {{ referral.date|date:"d" }} {% trans "of" %} {{ referral.date|date:"F" }} {% trans "of" %} {{ referral.date|date:"Y" }}<br /></p>

    <div class="main_area">

        <form action="/upload/{{ object.id}}/{{ referral.id }}/attach/save/" method="post" name="attach" enctype="multipart/form-data" class="upload_referral">

            <input type="hidden" name="object_id" value="{{ object.id }}" />
            <input type="hidden" name="client_id" value="{{ object.id }}" />

            <fieldset>
                <legend>Novo anexo</legend>
                <div id="documents">
                    <div class="documents_form">

                        <label>Arquivo<br /><input type="file" class="file" name="file" required /></label>

                        <label>Permiss&atilde;o de leitura
                            <br /><input type="checkbox" id="onlyprofessionals" name="onlyprofessionals" value="True" />&nbsp;Profissional
                            <br /><input type="checkbox" id="onlypsychologists" name="onlypsychologists" value="True" />&nbsp;Psic√≥logo
                        </label>

                        <label>Tipo de documento<br />
                            <select name="doc_type" class="big">
                                    {% for type in types %}
                                        <option value="{{ type.0 }}">{{ type.1 }}</option>
                                    {% endfor %}
                            </select>
                        </label>

                        <label>Assunto do documento<br /><input name="description" type="text" class="big" /></label>

                        <label><input type="submit" class="btn" value="Enviar Arquivo" /></label>

                    </div>

                    <br class="newline" />
                    <br />

                </div>
            </fieldset>
        </form>


        {% if attachs %}
          <form> <!-- just for layout right -->
            <fieldset>
                <legend>Anexos</legend>
                <div id="documents">
                    <div class="documents_form">
                        <table>

                            <!-- title column table -->
                            <tr>
                                <td>Data</td>
                                <td>Arquivo</td>
                                <td>Assunto</td>
                                <td>Permiss&atilde;o leitura</td>
                            </tr>

                            {% for a in attachs %}
                                <tr width="300px;">

                                    <td style="width:15%" ><span class="date">{{ a.date|date:"d-m-Y" }} </span><br /><span class="time">{{ a.date|date:"P" }}</span></td>

                                    <td style="width:25%"><span class="pdf">
                                                
                                        {% if is_psychologist %}
                                                    <a href="/media/img/organization/{{ organization }}/attach/{{ a.file }}" target="_blank">{{ a.filename|truncatechars:25 }}</a></span></td>
                                        {% elif is_secretary and a.only_psychologists%}
                                            {{ a.filename|truncatechars:20 }}
                                        {% elif is_secretary and a.only_professionals %}
                                            {{ a.filename|truncatechars:20 }}
                                        {% elif  is_professional and  a.only_psychologists %}
                                            {{ a.filename|truncatechars:20 }}
                                        {% else %}
                                            <a href="/media/img/organization/{{ organization }}/attach/{{ a.file }}" target="_blank">{{ a.filename }}</a>
                                        {% endif %}

                                    </td>

                                    <td style="width:40%">
                                        {% for t in types %}{% ifequal a.type t.0 %}<span>{{ t.1 }}<br />{{ a.description }}</span> {% endifequal %}{% endfor %}
                                    </td>

                                    <td style="width:15%">
                                        <span>
                                            {% if a.only_psychologists %}
                                                psicologo<br/>
                                            {% endif %}

                                            {% if a.only_professionals %}
                                                Profissional
                                            {% endif %}
                                        </span>
                                    </td>
                                    
                                </tr>
                            {% endfor %}

                        </table>
                    </div>
                </div>
            </fieldset>
            <br />
          </form>

        {% else %}
             <p class="empty">Nenhum documento anexado</p>
        {% endif %}

    </div><!-- main area -->


    <div id="sidebar" class="sidebar_client_top">
        {% if object.id %}
            {% include "tags/client_sidebar.html" %}
        {% endif %}
    </div>

{% endblock %}

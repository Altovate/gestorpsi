{% comment %}

Copyright (C) 2008 GestorPsi

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

{% endcomment %}

{% load i18n %}

<h2 class="title_schedule title">{% if occurrence.event.referral.referralgroup_set.all %}<a href="/service/group/{{ occurrence.event.referral.referralgroup_set.all.0.id }}/form/">{{ occurrence.event.referral.group_name }}</a>{% else %}{{ occurrence.event.referral.client.all.0 }}{% endif %} - {{ occurrence.event.referral }}</h2>
<p class="description">{{ occurrence.start_time|date:"d" }} {% trans "of" %} {{ occurrence.start_time|date:"F" }} {% trans "of" %} {{ occurrence.start_time|date:"Y" }}

{% comment %}
hide Date fields and second field
{% endcomment %}

<form method="post" action="" class="schedule_occurrence">
    <div class="main_area">

        <!-- confirm occurrence -->
        <fieldset>
            <legend>{% trans "Occurrence Confirmation Details" %}</legend>
            <label>
                {{ form.presence.label }}<br />
                {{ form.presence }}
                {{ form.presence.errors }}
            </label>

            <div style="clear:both"></div>

            <div class="date_fields{% if hide_date_field %} hidden{% endif %}">
                <label>{{ form.date_started.label }}<br />
                    <div class="nomargin">{{ form.date_started }}</div>
                </label>
                <label>{{ form.date_finished.label }}<br />
                    <div class="nomargin">{{ form.date_finished }}</div>
                </label>
            </div>

            <div style="clear:both"></div>

            <label>
                {{ form.reason.label }}<br />
                {{ form.reason }}
            </label>

            <label>{{ form.device.label }}<br /></label>
            <div class="overflow">
                {{ form.device }}
            </div>        

            <label>
                {% trans "Notes" %}<br />
                <textarea rows="10" name="occurrence_annotation" class="giant">{% if occurrence.annotation %}{{ occurrence.annotation }}{% endif %}</textarea>
            </label>            

        </fieldset>


        <!-- payment event -->
            <input type="hidden" value="{{ c.id }}">

            <fieldset>
                <legend>{% trans "Payment" %}</legend>
                <div>
                    <label>{% trans 'Pagamento' %}
                        <br />
                        <select class='big' id='payment_select' name='payment_select'>
                            <option value='0' selected >- - -</option>
                            {% for x in payment_list %}
                                <option value='{{ x.id }}'>R$ {{ x.price }} - {{ x.created }} ({{x.get_status_display}})</option>
                            {% endfor %}
                            <option value='new' >Criar novo pagamento</option>
                        </select>
                    </label>
                </div>

               <!-- show this select when create new payment -->
                <div id='covenant' style="display: none;">
                    <label>Conv&ecirc;nio
                        <br />
                        <select class='big' name='covenant_select' id='covenant_select'>
                            <option value='None' selected >- - -</option>
                            {% for x in referral.covenant.all %}
                                <option value='{{ x.id }}'>{{ x.name }} R$ {{ x.price }} {% if x.event_time %}(Pacote {{ x.event_time }}) {% endif %}</option>
                            {% endfor %}
                        </select>
                    </label>
                </div>
            </fieldset>


            <!-- form payment covenant -->
            {% for c in referral.covenant.all %}
                <div id="payment_form_covenant{{ c.id }}" style="display: none;">
                    <fieldset>
                        <legend>{% trans "Conv&ecirc;nio" %}</legend>
                        <label>{% trans 'Name' %}<br /><input class="big" type='text' readonly value="{{ c.name }}" /></label>
                        {% if c.event_time %}<label>Pacote<br /><input class="big" type='text' name='package' readonly value="{{ c.event_time }}" /></label>{% endif %}
                        <label>Valor R$<br /><input class="big" type='text' name="price{{c.id}}" readonly value="{{ c.price }}" /></label>
                        <label>Desconto R$<br /> <input class="big" type='text' name="off{{c.id}}" /></label>
                        <label>Total R$<br /> <input class="big" type='text' name="total{{c.id}}" readonly value="{{ c.price }}" /></label>

                        <label>{% trans 'Situa&ccedil;&atilde;o' %}<br />
                            {{ payment_form.status }}
                        </label>

                        <label>Forma de pagamento<br />
                            <select class="medium" name="payment_way{{c.id}}">
                                {% for pw in c.payment_way.all %}
                                    <option value="{{ pw.id }}"> {{ pw.name }}</option>
                                {% endfor %}
                            </select>
                        </label>
                    </fieldset>
                </div>
            {% endfor %}


            <!-- form for new payment -->
            <div id="payment_form_new" style="display: none;">
                <fieldset>
                    <legend>{% trans "Novo pagamento" %}</legend>
                    <label>{% trans 'Name' %}<br /><input class="big" type='text' readonly value="{{ c.name }}" /></label>
                    <label>Pacote<br /><input class="big" type='text' name='package' readonly value="{{ c.event_time }}" /></label>
                    <label>Valor R$<br /><input class="big" type='text' name="value{{c.id}}" readonly value="{{ c.price }}" /></label>
                    <label>Desconto R$<br /> <input class="big" type='text' name="off{{c.id}}" /></label>
                    <label>Total R$<br /> <input class="big" type='text' name="total{{c.id}}" readonly /></label>

                    <label>{% trans 'Situa&ccedil;&atilde;o' %}<br />
                        {{ payment_form.status }}
                    </label>

                    <label>Forma de pagamento<br />
                        <select class="medium" name="payment_way{{c.id}}">
                            {% for pw in c.payment_way.all %}
                                <option value="{{ pw.id }}"> {{ pw.name }}</option>
                            {% endfor %}
                        </select>
                    </label>
                </fieldset>
            </div>

            <!-- a form for each payment ready in service -->
            {% for c in payment_list %}
                <div id="payment_form{{ c.id }}" style="display: none;">
                    <fieldset>
                        <legend>Pagamento</legend>
                        <label>Data<br /><input class="big" type='text' readonly value="{{ c.created }}" /></label>
                        <label>Pacote<br /><input class="big" type='text' name='package' readonly value="{{ c.event_time }}" /></label>
                        <label>Valor R$<br /><input class="big" type='text' name="price{{c.id}}" readonly value="{{ c.price }}" /></label>
                        <label>Desconto R$<br /> <input class="big" type='text' name="off{{c.id}}" /></label>
                        <label>Total R$<br /> <input class="big" type='text' name="total{{c.id}}" readonly /></label>

                        <label>{% trans 'Situa&ccedil;&atilde;o' %}<br />
                            {{ payment_form.status }}
                        </label>

                        <label>Forma de pagamento<br />
                            <select class="medium" name="payment_way{{c.id}}">
                                {% for pw in c.payment_way.all %}
                                    <option value="{{ pw.id }}"> {{ pw.name }}</option>
                                {% endfor %}
                            </select>
                        </label>
                    </fieldset>
                </div>
            {% endfor %}

      <br />
    </div>
<!-- </form> will be close in another file -->

----------------------------------
GestorPsi - Psychology Services Management System
----------------------------------


IMPORTANT!! IMPORTANT!! IMPORTANT!!

GestorPSI uses South (http://south.aeracode.org/) for django schema migrations.
So, before to start with any updating, we really recommend the documentation reading 
from this project


UPGRADING FROM A SVN VERSION
--------------------

- Check if you have 'south' installed in your python libraries path and in your INSTALLED_APPS, 
in settings.py file. ** NOT REQUIRED FOR WORKING VERSIONS MAJOR THAN r1080.

- Check in your Database, if you have a table called 'south_migrationhistory'. If not, you must 
to create it. ** NOT REQUIRED FOR WORKING VERSIONS MAJOR THAN r1080

    $ python manage.py dbshell

    BEGIN;
    CREATE TABLE "south_migrationhistory" (
        "id" serial NOT NULL PRIMARY KEY,
        "app_name" varchar(255) NOT NULL,
        "migration" varchar(255) NOT NULL,
        "applied" timestamp with time zone
    )
    ;
    COMMIT;
    
- Remove all olders versions, if exists:

    cd <gestorpsi_dir>
    rm -rf */migrations
    ./manage.py shell
    from south.models import MigrationHistory
    MigrationHistory.objects.all().delete()

- Create your actual schema for apps that you want to migrate:

    $ python manage.py convert_to_south referral
    $ python manage.py convert_to_south schedule

- Update your code from SVN:
    
    $ svn up referral/ schedule/

- Generate your new schema for models that has been updated:
    
    $ python manage.py startmigration referral last --auto
    $ python manage.py startmigration schedule last --auto
    
- [Optional] If you want to see your migration proccess status any time, type the follow command:
    
    $ ./manage.py migrate --list

- [Optional] If you want to see your what changes will be done in your database schema, open the 
migrations files, generated by the startmigration command:
    
    $ more referral/migrations/0002_last.py
    $ more schedule/migrations/0002_last.py

- Commit changes in database:

    $ python manage.py migrate referral 0002_last
    $ python manage.py migrate schedule 0002_last


On this document, we only update two apps (referral and schedule). 
You can do the same with how many apps you need. 
If you want to upgrade ALL apps to last repository version or to an specific version, 
you can use the 'upgrade.sh' script, in your root folder project.


License
-------
GestorPsi is distributed under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2 of the
License, or (at your option) any later version.  A copy of this license
can be found in the file COPYING included with the source code of this
program.

Ideas, questions, patches and bug reports
support@gestopsi.com.br

--
2007-2009 by GestorPsi
www.gestorpsi.com.br
